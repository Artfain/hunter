<!DOCTYPE html>
<html lang="ru">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <title>Hunter Wallet</title>
  <link rel="stylesheet" href="styles.css">
  <!-- Подключение Telegram Web App SDK -->
  <script src="https://telegram.org/js/telegram-web-app.js"></script>
  <script>
    window.addEventListener('load', function() {
      const tg = window.Telegram.WebApp;
      tg.expand(); // Разворачиваем приложение на весь экран, если необходимо

      // Применяем тему Telegram (настройки цвета и оформления)
      if (tg.themeParams) {
        document.body.style.backgroundColor = tg.themeParams.bg_color;
        document.body.style.color = tg.themeParams.text_color;
      }

      // Получаем данные пользователя, переданные Telegram
      const user = tg.initDataUnsafe.user;
      if (user) {
        document.getElementById('user-info').innerText = `Привет, ${user.first_name}!`;
      } else {
        document.getElementById('user-info').innerText = 'Пожалуйста, авторизуйтесь через Telegram.';
      }

      // Функция для отправки данных на сервер (например, для регистрации кошелька)
      async function sendData() {
        if (!user) {
          alert("Авторизуйтесь через Telegram!");
          return;
        }
        const payload = {
          user_id: user.id,
          first_name: user.first_name,
          last_name: user.last_name,
          username: user.username,
          auth_date: tg.initDataUnsafe.auth_date
        };

        try {
          const response = await fetch("http://34.116.220.50:5000/auth", {
            method: "POST",
            headers: {"Content-Type": "application/json"},
            body: JSON.stringify(payload)
          });
          const data = await response.json();
          console.log("Ответ сервера:", data);
          alert("Данные успешно отправлены!");
        } catch (e) {
          console.error("Ошибка при отправке данных:", e);
          alert("Ошибка при отправке данных");
        }
      }

      // Привязываем функцию отправки к кнопке авторизации
      document.getElementById('auth-btn').addEventListener('click', sendData);
    });
  </script>
</head>
<body>
  <div id="content">
    <h1>Hunter Wallet</h1>
    <p id="user-info">Загрузка...</p>
    <button id="auth-btn">Авторизоваться через Telegram</button>
    <!-- Здесь можно разместить дополнительные элементы: баланс кошелька, историю транзакций, и т.п. -->
    <p>Для открытия кошелька перейдите по ссылке: <a href="https://t.me/wallet" target="_blank">Telegram Wallet</a></p>
  </div>
</body>
</html>
